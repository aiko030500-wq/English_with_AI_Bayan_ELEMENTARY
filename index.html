<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ENGLISH WITH AI BAYAN ‚Äì Intermediate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{
      --blue-main:#005b73;
      --blue-soft:#008a9e;
      --gold:#ffd54f;
      --bg:#f3f7fa;
      --topicColor:#005b73;
    }

    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }

    body{
      background:var(--bg);
      color:#043042;
    }

    /* HEADER WITH GIRL LOGO */
    header{
      background:linear-gradient(90deg,#005b73,#008a9e);
      color:#fff;
      padding:10px 24px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 2px 6px rgba(0,0,0,.2);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .logo-img{
      width:50px;
      height:50px;
      border-radius:50%;
      object-fit:cover;
      border:3px solid var(--gold);
      background:white;
    }

    .brand-text h1{
      font-size:18px;
      letter-spacing:.04em;
    }

    .brand-text span{
      font-size:12px;
      opacity:.9;
    }

    .top-info{
      font-size:13px;
      text-align:right;
    }
    .top-info strong{color:var(--gold);}

    main{
      padding:16px;
      max-width:1300px;
      margin:0 auto;
    }

    .card{
      background:#fff;
      border-radius:14px;
      box-shadow:0 4px 14px rgba(0,0,0,.08);
      padding:20px;
    }

    .hidden{display:none !important;}

    .section-title{
      font-size:18px;
      margin-bottom:10px;
      font-weight:600;
    }
    .muted{
      color:#607080;
      font-size:12px;
    }

    .field-label{
      font-size:14px;
      margin-bottom:4px;
    }

    .text-input{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #c9d5df;
      margin-bottom:14px;
      font-size:14px;
    }
    .text-input:focus{
      outline:none;
      border-color:var(--blue-soft);
      box-shadow:0 0 0 2px rgba(0,138,158,.2);
    }

    .btn{
      border:none;
      border-radius:10px;
      padding:10px 18px;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
    }
    .btn-primary{
      background:var(--blue-soft);
      color:#fff;
    }
    .btn-primary:hover{background:#007487;}
    .btn-ghost{
      background:#eef5f9;
      color:var(--blue-main);
    }
    .btn-ghost:hover{background:#dde9f1;}

    .login-note{
      font-size:12px;
      color:#526675;
      margin-top:10px;
      line-height:1.4;
    }

    .error{
      margin-top:10px;
      color:#b00020;
      font-size:13px;
    }

    /* SCREENS */
    #loginScreen{
      max-width:520px;
      margin:40px auto;
    }

    #mainMenuScreen{
      display:grid;
      grid-template-columns:2fr 1.2fr;
      gap:16px;
    }
    @media(max-width:960px){
      #mainMenuScreen{
        grid-template-columns:1fr;
      }
    }

    .tag{
      display:inline-block;
      padding:2px 6px;
      border-radius:999px;
      background:#e3f2fd;
      font-size:11px;
      color:#005b73;
    }

    .top-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:12px;
    }

    .stars-badge{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:4px 8px;
      border-radius:999px;
      background:#fff9e5;
      border:1px solid #ffe082;
      font-size:12px;
    }
    .star-icon{color:#ffb300;}

    .topics-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:8px;
    }
    @media(max-width:700px){
      .topics-grid{grid-template-columns:1fr;}
    }

    .topic-card{
      border-radius:12px;
      border:1px solid #dde5ee;
      padding:10px 12px;
      background:#f8fafc;
      cursor:pointer;
      transition:.15s;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .topic-card:hover{
      background:#e3f2fd;
      transform:translateY(-1px);
    }
    .topic-card-title{
      font-size:14px;
      font-weight:600;
    }
    .topic-card-sub{
      font-size:11px;
      color:#607080;
    }

    /* AI PANEL (demo) */
    #aiPanel{
      background:#fff;
      border-radius:14px;
      padding:14px;
      box-shadow:0 2px 10px rgba(0,0,0,.06);
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:260px;
    }
    #aiPanel h3{
      font-size:15px;
      margin-bottom:4px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }
    #aiLimit{
      font-size:11px;
    }
    .chat-note{
      font-size:11px;
      color:#607080;
    }
    .chat-box{
      flex:1;
      border-radius:10px;
      border:1px solid #dde5ee;
      padding:8px;
      background:#f8fafc;
      font-size:13px;
      overflow-y:auto;
    }
    .chat-msg{
      margin-bottom:6px;
      line-height:1.4;
    }
    .chat-msg strong{color:#005b73;}
    #aiQuestion{
      width:100%;
      min-height:60px;
      resize:vertical;
      border-radius:10px;
      border:1px solid #c9d5df;
      padding:8px;
      font-size:13px;
      margin-top:4px;
    }
    #aiQuestion:focus{
      outline:none;
      border-color:var(--blue-soft);
      box-shadow:0 0 0 2px rgba(0,138,158,.17);
    }
    .chat-actions{
      display:flex;
      justify-content:flex-end;
      margin-top:4px;
    }

    /* TOPIC SCREEN */
    #topicScreen{
      max-width:1000px;
      margin:0 auto;
    }
    .topic-header{
      border-radius:16px 16px 0 0;
      padding:14px 16px;
      background:linear-gradient(90deg,var(--topicColor),#007d99);
      color:#fff;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .topic-header-main{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .topic-header-title{
      font-size:18px;
      font-weight:600;
    }
    .topic-header-tag{
      font-size:11px;
      opacity:.9;
    }
    .topic-header-buttons{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
    }
    .btn-topic{
      border:none;
      border-radius:999px;
      padding:6px 12px;
      font-size:12px;
      cursor:pointer;
      font-weight:600;
    }
    .btn-topic.back{
      background:#ffffff;
      color:var(--topicColor);
    }
    .btn-topic.menu{
      background:rgba(255,255,255,.15);
      color:#fff;
      border:1px solid rgba(255,255,255,.5);
    }

    .topic-body{
      background:#fff;
      border-radius:0 0 16px 16px;
      box-shadow:0 4px 14px rgba(0,0,0,.08);
      padding:16px;
    }

    .grammar-box{
      background:#f7fbff;
      border-left:4px solid var(--topicColor);
      padding:10px 12px;
      border-radius:10px;
      margin-bottom:12px;
      font-size:14px;
      line-height:1.5;
    }
    .grammar-box strong{color:#005b73;}
    .formula{
      font-family:"Consolas","Courier New",monospace;
      background:#e3f2fd;
      padding:3px 6px;
      border-radius:6px;
      margin-right:4px;
      display:inline-block;
      margin-top:4px;
    }
    .examples{
      margin-top:8px;
      font-size:13px;
    }
    .examples li{
      margin-left:18px;
      margin-bottom:2px;
    }
    .grammar-ru{
      margin-top:10px;
      font-size:13px;
      color:#24313f;
    }

    .exercises{
      margin-top:12px;
    }
    .exercise-block{
      border-radius:12px;
      background:#f8fafc;
      padding:10px 12px;
      margin-bottom:10px;
      border:1px solid #dde5ee;
    }
    .exercise-title{
      font-size:14px;
      font-weight:600;
      margin-bottom:6px;
    }
    .question-row{
      font-size:13px;
      margin-bottom:6px;
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:6px;
    }
    .question-text{
      flex:1 1 160px;
    }
    .options{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center;
    }
    .options label{
      background:#ffffff;
      border-radius:999px;
      border:1px solid #ccd7e3;
      padding:2px 8px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:3px;
    }
    .options input[type="radio"]{
      accent-color:var(--topicColor);
    }
    .mark{
      width:18px;
      text-align:center;
      font-size:16px;
      font-weight:700;
    }
    .mark.correct{color:#2e7d32;}
    .mark.wrong{color:#c62828;}
    .exercise-footer{
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }
    .exercise-footer small{
      font-size:11px;
      color:#607080;
    }

    /* TEACHER */
    #teacherScreen{
      margin-top:20px;
    }
    .top-buttons{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    .table-wrapper{
      overflow-x:auto;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
      margin-top:10px;
    }
    th,td{
      border:1px solid #dde5ee;
      padding:6px 8px;
      text-align:left;
      white-space:nowrap;
    }
    th{
      background:#eef5f9;
      font-weight:600;
    }

    /* PRINT: only topic */
    @media print{
      header, #loginScreen, #mainMenuScreen, #teacherScreen{
        display:none !important;
      }
      body{
        background:#fff;
      }
      #topicScreen{
        display:block !important;
        margin:0;
        padding:0;
      }
      .topic-body{
        box-shadow:none;
        border-radius:0;
      }
    }
  </style>
</head>
<body>
<header>
  <div class="brand">
    <img src="logo.png" alt="AI Bayan" class="logo-img">
    <div class="brand-text">
      <h1>ENGLISH WITH AI BAYAN</h1>
      <span>Intermediate ¬∑ 20 grammar topics</span>
    </div>
  </div>
  <div class="top-info" id="topInfo">Not logged in</div>
</header>

<main>
  <!-- LOGIN -->
  <section id="loginScreen" class="card">
    <h2 class="section-title">Login</h2>
    <p class="muted" style="margin-bottom:10px">
      Enter your <strong>Name</strong> and <strong>Code</strong>. Ask your teacher for the code.
    </p>

    <label class="field-label" for="loginName">Name</label>
    <input id="loginName" class="text-input" type="text" placeholder="Your name" />

    <label class="field-label" for="loginCode">Code</label>
    <input id="loginCode" class="text-input" type="password" placeholder="Student or teacher code" />

    <div style="display:flex;gap:8px;margin-top:4px">
      <button class="btn btn-primary" onclick="handleLogin()">Login</button>
      <button class="btn btn-ghost" onclick="backToLogin()">Reset</button>
    </div>

    <div id="loginError" class="error hidden"></div>

    <p class="login-note">
      Student PIN ranges: 3E (101-115), 4G (201-215), 5G (301-315), 5Zh (401-415),
      6G (501-515), 7B (601-615), 7V (701-715), 8E (801-815), 9Zh (901-915), 10A (1001-1015).<br>
      Teacher code: <strong>3234</strong>.
    </p>
  </section>

  <!-- MAIN MENU (STUDENT) -->
  <section id="mainMenuScreen" class="hidden">
    <section class="card">
      <div class="top-row">
        <div>
          <h2 class="section-title" style="margin-bottom:4px;">Intermediate grammar topics</h2>
          <div id="menuInfo" class="muted"></div>
        </div>
        <div>
          <span class="stars-badge">
            <span class="star-icon">‚≠ê</span>
            Stars: <span id="menuStars">0</span>
          </span>
        </div>
      </div>

      <div class="topics-grid" id="menuTopics"></div>
    </section>

    <aside id="aiPanel">
      <div>
        <h3>
          AI Bayan
          <span id="aiLimit"></span>
        </h3>
        <p class="chat-note">
          Demo mode. AI chat will be added later.
        </p>
      </div>

      <div id="chatBox" class="chat-box"></div>

      <div>
        <textarea id="aiQuestion"
                  placeholder="AI chat will be available soon."
                  disabled></textarea>
        <div class="chat-actions">
          <button class="btn btn-primary" id="askBtn" disabled>Ask (soon)</button>
        </div>
        <p class="chat-note">
          Your questions will be visible for the teacher in the future version.
        </p>
      </div>
    </aside>
  </section>

  <!-- TOPIC SCREEN -->
  <section id="topicScreen" class="hidden">
    <div class="topic-header">
      <div class="topic-header-main">
        <div class="topic-header-title" id="topicHeaderTitle">Topic</div>
        <div class="topic-header-tag" id="topicHeaderTag"></div>
      </div>
      <div class="topic-header-buttons">
        <button class="btn-topic back" onclick="backToMenu()">‚Üê Back</button>
        <button class="btn-topic menu" onclick="backToMenu()">üè† Main menu</button>
        <button class="btn-topic menu" onclick="printCurrentTopic()">üñ® Print</button>
      </div>
    </div>
    <div class="topic-body">
      <div id="topicRuleContainer"></div>
      <div id="topicExercisesContainer"></div>
      <div id="topicStatus" class="muted" style="margin-top:8px;"></div>
    </div>
  </section>

  <!-- TEACHER -->
  <section id="teacherScreen" class="hidden card">
    <div class="top-buttons">
      <button class="btn btn-ghost" onclick="backToLogin()">‚Üê Back to login</button>
      <span class="tag">Teacher mode</span>
    </div>
    <h2 class="section-title">Teacher dashboard</h2>
    <p class="muted">
      Shows data saved in this browser: stars and last login (per code).
    </p>

    <div class="table-wrapper">
      <table id="teacherTable">
        <thead>
          <tr>
            <th>Class</th>
            <th>Code</th>
            <th>Name</th>
            <th>Stars</th>
            <th>Last login</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>
</main>

<script>
/* ---------- CLASS RANGES (PIN) ---------- */

const classRanges = [
  { cls: "3E",  from: 101,  to: 115 },
  { cls: "4G",  from: 201,  to: 215 },
  { cls: "5G",  from: 301,  to: 315 },
  { cls: "5Zh", from: 401,  to: 415 },
  { cls: "6G",  from: 501,  to: 515 },
  { cls: "7B",  from: 601,  to: 615 },
  { cls: "7V",  from: 701,  to: 715 },
  { cls: "8E",  from: 801,  to: 815 },
  { cls: "9Zh", from: 901,  to: 915 },
  { cls: "10A", from: 1001, to: 1015 }
];

function getClassByCode(num){
  for (const r of classRanges){
    if (num >= r.from && num <= r.to){
      return r.cls;
    }
  }
  return null;
}

/* ---------- TOPIC COLORS ---------- */

const topicColors = {
  1:"#1976d2",
  2:"#00796b",
  3:"#6a1b9a",
  4:"#ef6c00",
  5:"#00838f",
  6:"#8e24aa",
  7:"#5d4037",
  8:"#c2185b",
  9:"#455a64",
  10:"#2e7d32",
  11:"#7b1fa2",
  12:"#1565c0",
  13:"#d81b60",
  14:"#0097a7",
  15:"#8d6e63",
  16:"#9e9d24",
  17:"#3949ab",
  18:"#00695c",
  19:"#ad1457",
  20:"#ff7043"
};

/* ---------- TOPICS (20 INTERMEDIATE) ---------- */

const topics = [
  {
    id:1,
    title:"Present Perfect vs Past Simple",
    level:"Intermediate",
    explanation:"Present Perfect is used for life experience and results that are connected with now (ever, never, already, yet) and we do not say the exact finished time. Past Simple is used for finished actions in the past with a clear time (yesterday, last week, in 2020).",
    ruleRu:"Present Perfect ‚Äì –æ–ø—ã—Ç –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –Ω–∞—Å—Ç–æ—è—â–∏–º, –±–µ–∑ —Ç–æ—á–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (ever, never, already, yet). Past Simple ‚Äì –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –ø—Ä–æ—à–ª–æ–º —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏ (yesterday, last year, in 2020).",
    formulas:["have/has + V3","V2 / V-ed"],
    examples:[
      "I have seen this film three times.",
      "I saw this film last year."
    ],
    exercises:[]
  },
  {
    id:2,
    title:"Present Perfect Continuous",
    level:"Intermediate",
    explanation:"We use Present Perfect Continuous for actions that started in the past and are still happening now or have a visible result now. We often use it with for, since, recently, lately.",
    ruleRu:"Present Perfect Continuous ‚Äì –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞—á–∞–ª–æ—Å—å –≤ –ø—Ä–æ—à–ª–æ–º –∏ –¥–ª–∏—Ç—Å—è –¥–æ —Å–∏—Ö –ø–æ—Ä –∏–ª–∏ –¥–∞–ª–æ –≤–∏–¥–∏–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–µ–π—á–∞—Å. –ß–∞—Å—Ç–æ —Å for, since, recently, lately.",
    formulas:["have/has been + V-ing"],
    examples:[
      "I have been studying English for three years.",
      "She has been working here since 2020."
    ],
    exercises:[]
  },
  {
    id:3,
    title:"Past Continuous vs Past Simple",
    level:"Intermediate",
    explanation:"Past Continuous describes a long or background action in the past. Past Simple describes short, finished actions that happened one after another or interrupted the background action.",
    ruleRu:"Past Continuous ‚Äì –¥–ª–∏—Ç–µ–ª—å–Ω–æ–µ –∏–ª–∏ —Ñ–æ–Ω–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –ø—Ä–æ—à–ª–æ–º. Past Simple ‚Äì –∫–æ—Ä–æ—Ç–∫–æ–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, —á–∞—Å—Ç–æ ¬´–≤—Ä–µ–∑–∞–µ—Ç—Å—è¬ª –≤ —Ñ–æ–Ω (when/while).",
    formulas:["was/were + V-ing","V2 / V-ed"],
    examples:[
      "I was watching TV when he called.",
      "It started to rain while we were walking home."
    ],
    exercises:[]
  },
  {
    id:4,
    title:"Future forms: will / going to / Present Continuous",
    level:"Intermediate",
    explanation:"Will is used for instant decisions, promises and predictions. Be going to is used for plans and intentions and for predictions with evidence. Present Continuous is used for fixed future arrangements (timetable, meeting, calendar).",
    ruleRu:"Will ‚Äì —Ä–µ—à–µ–Ω–∏–µ —Å–µ–π—á–∞—Å, –æ–±–µ—â–∞–Ω–∏–µ, –ø—Ä–æ–≥–Ω–æ–∑. Be going to ‚Äì –ø–ª–∞–Ω –∏–ª–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ, ¬´—è —Å–æ–±–∏—Ä–∞—é—Å—å¬ª. Present Continuous ‚Äì –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç—å –Ω–∞ –±—É–¥—É—â–µ–µ (–≤—Å—Ç—Ä–µ—á–∏, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ).",
    formulas:["will + V","am/is/are going to + V","am/is/are + V-ing (future)"],
    examples:[
      "I think it will rain tomorrow.",
      "We are going to visit our grandma.",
      "They are meeting at 7 pm."
    ],
    exercises:[]
  },
  {
    id:5,
    title:"Used to / be used to / get used to",
    level:"Intermediate",
    explanation:"Used to + V is for past habits or states that are not true now. Be used to + V-ing/noun is for something that is normal for you now. Get used to + V-ing/noun is the process of becoming accustomed.",
    ruleRu:"Used to + V ‚Äì —Ä–∞–Ω—å—à–µ –¥–µ–ª–∞–ª/–±—ã–ª–æ, –Ω–æ —Å–µ–π—á–∞—Å –Ω–µ—Ç. Be used to + V-ing/—Å—É—â. ‚Äì –ø—Ä–∏–≤—ã–∫, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. Get used to + V-ing/—Å—É—â. ‚Äì –ø—Ä–∏–≤—ã–∫–∞–µ—Ç (–ø—Ä–æ—Ü–µ—Å—Å).",
    formulas:["used to + V","be used to + V-ing / noun","get used to + V-ing / noun"],
    examples:[
      "I used to live in a village.",
      "She is used to getting up early.",
      "They are getting used to online lessons."
    ],
    exercises:[]
  },
  {
    id:6,
    title:"Modal verbs of deduction (must / might / can‚Äôt)",
    level:"Intermediate",
    explanation:"We use must when we are almost sure something is true now, might/may/could when it is possible, and can‚Äôt when we are sure it is impossible.",
    ruleRu:"–ú–æ–¥–∞–ª—å–Ω—ã–µ –≥–ª–∞–≥–æ–ª—ã –¥–ª—è –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π –æ –Ω–∞—Å—Ç–æ—è—â–µ–º: must ‚Äì –Ω–∞–≤–µ—Ä–Ω—è–∫–∞; might/may/could ‚Äì –≤–æ–∑–º–æ–∂–Ω–æ; can‚Äôt ‚Äì –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å.",
    formulas:["must + V","might / may / could + V","can‚Äôt + V"],
    examples:[
      "He must be at home ‚Äì the lights are on.",
      "She might be at the library.",
      "He can‚Äôt be 10, he looks 20."
    ],
    exercises:[]
  },
  {
    id:7,
    title:"Second Conditional",
    level:"Intermediate",
    explanation:"Second Conditional is used for unreal or imaginary situations in the present or future: dreams, advice and hypothetical situations.",
    ruleRu:"Second Conditional ‚Äì –Ω–µ—Ä–µ–∞–ª—å–Ω—ã–µ, –≤–æ–æ–±—Ä–∞–∂–∞–µ–º—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –ø—Ä–æ –Ω–∞—Å—Ç–æ—è—â–µ–µ/–±—É–¥—É—â–µ–µ: –º–µ—á—Ç—ã, —Å–æ–≤–µ—Ç—ã ¬´–Ω–∞ —Ç–≤–æ—ë–º –º–µ—Å—Ç–µ¬ª.",
    formulas:["If + Past Simple, would + V"],
    examples:[
      "If I had a lot of money, I would travel around the world.",
      "If she studied harder, she would get better marks."
    ],
    exercises:[]
  },
  {
    id:8,
    title:"Mixed Conditionals",
    level:"Intermediate",
    explanation:"Mixed conditionals connect different times: unreal past action with a present result, or unreal present situation with a past result.",
    ruleRu:"–°–º–µ—à–∞–Ω–Ω—ã–µ —É—Å–ª–æ–≤–Ω—ã–µ —Å–≤—è–∑—ã–≤–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞: –µ—Å–ª–∏ –±—ã —á—Ç–æ-—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –≤ –ø—Ä–æ—à–ª–æ–º, —Å–µ–π—á–∞—Å –±—ã–ª–æ –±—ã –∏–Ω–∞—á–µ; –∏–ª–∏ –µ—Å–ª–∏ –±—ã —Å–µ–π—á–∞—Å –±—ã–ª–æ –ø–æ-–¥—Ä—É–≥–æ–º—É, –≤ –ø—Ä–æ—à–ª–æ–º –±—ã–ª–æ –±—ã –∏–Ω–∞—á–µ.",
    formulas:[
      "If + Past Perfect, would + V (now)",
      "If + Past Simple, would have + V3 (past result)"
    ],
    examples:[
      "If I had studied harder, I would be at university now.",
      "If I were taller, I would have become a basketball player."
    ],
    exercises:[]
  },
  {
    id:9,
    title:"Passive Voice (Intermediate)",
    level:"Intermediate",
    explanation:"In the Passive Voice we focus on the action, not on the doer. We use it when the doer is unknown, unimportant or obvious.",
    ruleRu:"–°—Ç—Ä–∞–¥–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ª–æ–≥ (Passive) ‚Äì –≤–∞–∂–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ, —á–µ–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: ¬´–¥–æ–º –ø–æ—Å—Ç—Ä–æ–∏–ª–∏¬ª, –∞ –Ω–µ ¬´–∫—Ç–æ-—Ç–æ –ø–æ—Å—Ç—Ä–æ–∏–ª –¥–æ–º¬ª. –ò—Å–ø–æ–ª—å–∑—É–µ–º, –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω –∏–ª–∏ –Ω–µ –≤–∞–∂–µ–Ω.",
    formulas:[
      "Present: am/is/are + V3",
      "Past: was/were + V3",
      "Future: will be + V3"
    ],
    examples:[
      "The homework is checked every day.",
      "This film was made in 2019.",
      "The project will be finished next week."
    ],
    exercises:[]
  },
  {
    id:10,
    title:"Reported Speech (statements & questions)",
    level:"Intermediate",
    explanation:"In reported speech we say what someone said without quotation marks and usually move the tense one step back into the past.",
    ruleRu:"–ö–æ—Å–≤–µ–Ω–Ω–∞—è —Ä–µ—á—å ‚Äì –ø–µ—Ä–µ–¥–∞—ë–º —á—É–∂–∏–µ —Å–ª–æ–≤–∞ –±–µ–∑ –∫–∞–≤—ã—á–µ–∫, –æ–±—ã—á–Ω–æ —Å–¥–≤–∏–≥–∞—è –≤—Ä–µ–º—è ¬´–Ω–∞ —à–∞–≥ –Ω–∞–∑–∞–¥¬ª: am ‚Üí was, do ‚Üí did, will ‚Üí would –∏ —Ç.–¥.",
    formulas:[
      "say / tell + (that) + clause",
      "Present ‚Üí Past, Past ‚Üí Past Perfect, will ‚Üí would"
    ],
    examples:[
      "He said that he was tired.",
      "She asked if I liked English."
    ],
    exercises:[]
  },
  {
    id:11,
    title:"Relative Clauses (who / which / where)",
    level:"Intermediate",
    explanation:"We use who for people, which for things and animals, and where for places to add extra information about a noun.",
    ruleRu:"–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è: who ‚Äì –ª—é–¥–∏, which ‚Äì –ø—Ä–µ–¥–º–µ—Ç—ã –∏ –∂–∏–≤–æ—Ç–Ω—ã–µ, where ‚Äì –º–µ—Å—Ç–∞. –û–Ω–∏ –ø–æ–º–æ–≥–∞—é—Ç —Å–æ–µ–¥–∏–Ω—è—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏ —É—Ç–æ—á–Ω—è—Ç—å —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ.",
    formulas:["noun + who/which/where + clause"],
    examples:[
      "The man who lives next door is a doctor.",
      "This is the place where we met.",
      "That‚Äôs the dog which barks a lot."
    ],
    exercises:[]
  },
  {
    id:12,
    title:"Gerunds & Infinitives",
    level:"Intermediate",
    explanation:"Some verbs are followed by a gerund (V-ing), some by an infinitive (to + V), and some by object + infinitive.",
    ruleRu:"–ü–æ—Å–ª–µ —Ä–∞–∑–Ω—ã—Ö –≥–ª–∞–≥–æ–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—ã: Gerund (V-ing) ‚Äì enjoy, avoid, finish; Infinitive (to V) ‚Äì want, decide, hope; –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è V + object + to V ‚Äì want someone to do.",
    formulas:["V + V-ing","V + to V","V + object + to V"],
    examples:[
      "I enjoy reading books.",
      "She decided to move.",
      "They want us to help."
    ],
    exercises:[]
  },
  {
    id:13,
    title:"Articles (a/an, the, zero)",
    level:"Intermediate",
    explanation:"We use a/an for a thing we mention for the first time or one of many, the for specific or known things, and no article (zero) for plural and uncountable nouns in general, languages, sports and most places.",
    ruleRu:"A/An ‚Äì ¬´–∫–∞–∫–æ–π-—Ç–æ, –æ–¥–∏–Ω¬ª (–≥–æ–≤–æ—Ä–∏–º –≤–ø–µ—Ä–≤—ã–µ). The ‚Äì ¬´—Ç–æ—Ç —Å–∞–º—ã–π, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π¬ª. –ù–æ–ª—å –∞—Ä—Ç–∏–∫–ª—è ‚Äì –≤–æ–æ–±—â–µ, –≤ —Ü–µ–ª–æ–º (music, water), —è–∑—ã–∫–∏, –≤–∏–¥—ã —Å–ø–æ—Ä—Ç–∞ –∏ —Ç.–ø.",
    formulas:[
      "a/an + singular countable noun",
      "the + specific noun",
      "√ò + general / plural / uncountable"
    ],
    examples:[
      "He is an engineer.",
      "I like the film you recommended.",
      "They play football."
    ],
    exercises:[]
  },
  {
    id:14,
    title:"Phrasal Verbs",
    level:"Intermediate",
    explanation:"A phrasal verb is a verb + a small word (particle) like up, on, off, after, and often the whole expression has a new meaning.",
    ruleRu:"–§—Ä–∞–∑–æ–≤—ã–π –≥–ª–∞–≥–æ–ª ‚Äì –≥–ª–∞–≥–æ–ª + –º–∞–ª–µ–Ω—å–∫–æ–µ —Å–ª–æ–≤–æ (up, on, off, after‚Ä¶), –≤–º–µ—Å—Ç–µ —á–∞—Å—Ç–æ –¥–∞—é—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: break up ‚Äì —Ä–∞—Å—Å—Ç–∞—Ç—å—Å—è, look after ‚Äì –ø—Ä–∏—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å.",
    formulas:["verb + particle ‚Üí new meaning"],
    examples:[
      "They broke up last year.",
      "She looks after her little brother.",
      "Please turn off the lights."
    ],
    exercises:[]
  },
  {
    id:15,
    title:"Linking Words",
    level:"Intermediate",
    explanation:"Linking words connect ideas: although and however show contrast; because shows reason; therefore shows result; in order to shows purpose.",
    ruleRu:"–°–≤—è–∑—É—é—â–∏–µ —Å–ª–æ–≤–∞: although ‚Äì —Ö–æ—Ç—è, however ‚Äì –æ–¥–Ω–∞–∫–æ, because ‚Äì –ø–æ—Ç–æ–º—É —á—Ç–æ, therefore ‚Äì –ø–æ—ç—Ç–æ–º—É, in order to ‚Äì —á—Ç–æ–±—ã (—Ü–µ–ª—å).",
    formulas:[
      "although + clause",
      "clause. However, clause.",
      "because + clause",
      "clause; therefore, clause.",
      "in order to + V"
    ],
    examples:[
      "Although it was cold, we went out.",
      "He was tired; however, he finished the work.",
      "She stayed home because she was ill."
    ],
    exercises:[]
  },
  {
    id:16,
    title:"Countable & Uncountable Nouns",
    level:"Intermediate",
    explanation:"Countable nouns can be counted (one, two, three apples). Uncountable nouns cannot be counted easily (water, rice, sugar). We use different quantifiers with them.",
    ruleRu:"–ò—Å—á–∏—Å–ª—è–µ–º—ã–µ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–∂–Ω–æ –ø–æ—Å—á–∏—Ç–∞—Ç—å (apple, book). –ù–µ–∏—Å—á–∏—Å–ª—è–µ–º—ã–µ –Ω–µ–ª—å–∑—è –ø–æ—Å—á–∏—Ç–∞—Ç—å –ø–æ—à—Ç—É—á–Ω–æ (water, rice, sugar). –° –Ω–∏–º–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ —Å–ª–æ–≤–∞ much/many, little/few –∏ —Ç.–¥.",
    formulas:[
      "many / few / a few + countable",
      "much / little / a little + uncountable",
      "some / any + –æ–±–∞ —Ç–∏–ø–∞"
    ],
    examples:[
      "There are many books.",
      "There is a little water.",
      "Do you have any friends here?"
    ],
    exercises:[]
  },
  {
    id:17,
    title:"Complex Object (V + object + to V)",
    level:"Intermediate",
    explanation:"Complex Object is used after verbs like want, ask, tell, expect, allow when one person wants another person to do something.",
    ruleRu:"–°–ª–æ–∂–Ω–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: –≥–ª–∞–≥–æ–ª + –æ–±—ä–µ–∫—Ç + to V. –ü—Ä–∏–º–µ—Ä—ã –≥–ª–∞–≥–æ–ª–æ–≤: want, ask, tell, expect, allow. I want you to help ‚Äì ¬´–Ø —Ö–æ—á—É, —á—Ç–æ–±—ã —Ç—ã –ø–æ–º–æ–≥¬ª.",
    formulas:["S + V + object + to V"],
    examples:[
      "I want you to listen carefully.",
      "They asked him to come early.",
      "She told me to wait."
    ],
    exercises:[]
  },
  {
    id:18,
    title:"Causative (have/get something done)",
    level:"Intermediate",
    explanation:"We use the causative when someone does something for us as a service: I had my hair cut (= someone cut my hair for me).",
    ruleRu:"–ö–∞—É–∑–∞—Ç–∏–≤: –º—ã –∑–∞–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ª—É–≥—É, –∏ –∫—Ç–æ-—Ç–æ –¥–µ–ª–∞–µ—Ç —á—Ç–æ-—Ç–æ –¥–ª—è –Ω–∞—Å. I had my hair cut ‚Äì –º–Ω–µ –ø–æ—Å—Ç—Ä–∏–≥–ª–∏ –≤–æ–ª–æ—Å—ã.",
    formulas:["have / get + object + V3"],
    examples:[
      "I had my phone repaired.",
      "She got her hair cut yesterday."
    ],
    exercises:[]
  },
  {
    id:19,
    title:"Cleft Sentences (It is/was ‚Ä¶ that ‚Ä¶)",
    level:"Intermediate",
    explanation:"Cleft sentences use It is/was to emphasise a person, thing, place or time: It was John who helped me.",
    ruleRu:"Cleft-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞—é—Ç –≤–∞–∂–Ω—É—é —á–∞—Å—Ç—å: It was John who helped me ‚Äì –∏–º–µ–Ω–Ω–æ –î–∂–æ–Ω –ø–æ–º–æ–≥ –º–Ω–µ.",
    formulas:["It is/was + noun/pronoun + who/that + clause"],
    examples:[
      "It was my mum who cooked dinner.",
      "It is this book that I like most."
    ],
    exercises:[]
  },
  {
    id:20,
    title:"Quantifiers: too / enough / so / such",
    level:"Intermediate",
    explanation:"We use too to mean more than is good, enough to mean sufficient, so before an adjective to mean very, and such + (a) + adjective + noun to mean very with a noun.",
    ruleRu:"Too ‚Äì —Å–ª–∏—à–∫–æ–º; enough ‚Äì –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ; so ‚Äì —Ç–∞–∫, –æ—á–µ–Ω—å; such ‚Äì —Ç–∞–∫–æ–π/—Ç–∞–∫–∞—è + —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ.",
    formulas:[
      "too + adjective",
      "adjective + enough",
      "so + adjective",
      "such + (a) + adjective + noun"
    ],
    examples:[
      "It is too cold.",
      "She is tall enough to play basketball.",
      "It is such a nice day."
    ],
    exercises:[]
  }
];

/* ---------- STATE & STORAGE ---------- */

let currentUser = null; // {name, code, classLabel, stars, lastLogin}
let currentTopicId = null;

function todayStr(){
  return new Date().toISOString().slice(0,10);
}
function studentKey(code){
  return "bayan_student_"+code;
}

function loadStudent(code,name,classLabel){
  const key = studentKey(code);
  let data = null;
  try{
    data = JSON.parse(localStorage.getItem(key));
  }catch(e){
    data=null;
  }
  if(!data){
    data = {
      name:name||"",
      code,
      classLabel,
      stars:0,
      lastLogin:null
    };
  }else{
    if(name) data.name = name;
    data.classLabel = classLabel;
  }
  data.lastLogin = todayStr();
  localStorage.setItem(key,JSON.stringify(data));
  return data;
}
function saveCurrent(){
  if(!currentUser) return;
  const key = studentKey(currentUser.code);
  localStorage.setItem(key,JSON.stringify(currentUser));
}

/* ---------- SCREEN SWITCHING ---------- */

function showOnly(id){
  document.getElementById("loginScreen").classList.add("hidden");
  document.getElementById("mainMenuScreen").classList.add("hidden");
  document.getElementById("topicScreen").classList.add("hidden");
  document.getElementById("teacherScreen").classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}
function setTopInfo(html){
  document.getElementById("topInfo").innerHTML = html;
}

/* ---------- LOGIN ---------- */

function handleLogin(){
  const name = document.getElementById("loginName").value.trim();
  const codeStr = document.getElementById("loginCode").value.trim();
  const errorEl = document.getElementById("loginError");
  errorEl.classList.add("hidden");
  errorEl.textContent = "";

  if(!codeStr){
    errorEl.textContent = "Enter your code.";
    errorEl.classList.remove("hidden");
    return;
  }

  if(codeStr==="3234"){
    setTopInfo(`Logged in as <strong>TEACHER</strong> ¬∑ code 3234`);
    renderTeacherTable();
    showOnly("teacherScreen");
    return;
  }

  const num = Number(codeStr);
  if(!Number.isInteger(num)){
    errorEl.textContent = "Code must be a number.";
    errorEl.classList.remove("hidden");
    return;
  }
  const classLabel = getClassByCode(num);
  if(!classLabel){
    errorEl.textContent = "Unknown student code. Ask your teacher.";
    errorEl.classList.remove("hidden");
    return;
  }
  if(!name){
    errorEl.textContent = "Enter your name.";
    errorEl.classList.remove("hidden");
    return;
  }

  currentUser = loadStudent(num,name,classLabel);
  saveCurrent();
  setTopInfo(
    `Class <strong>${currentUser.classLabel}</strong> ¬∑ Student: <strong>${currentUser.name}</strong> (code ${currentUser.code}) ¬∑ Stars: <strong id="topStars">${currentUser.stars}</strong>`
  );
  buildMainMenu();
  updateTopStars();
  showOnly("mainMenuScreen");
}

function backToLogin(){
  currentUser = null;
  setTopInfo("Not logged in");
  document.getElementById("loginCode").value = "";
  document.getElementById("loginName").value = "";
  showOnly("loginScreen");
}

/* ---------- MAIN MENU UI ---------- */

function buildMainMenu(){
  if(!currentUser) return;
  document.getElementById("menuInfo").innerHTML =
    `Class <strong>${currentUser.classLabel}</strong>, student <strong>${currentUser.name}</strong> (code ${currentUser.code})`;
  document.getElementById("menuStars").textContent = currentUser.stars ?? 0;

  const grid = document.getElementById("menuTopics");
  grid.innerHTML = "";
  topics.forEach(t=>{
    const div = document.createElement("div");
    div.className = "topic-card";
    const color = topicColors[t.id] || "#005b73";
    div.style.borderColor = color+"55";
    div.style.background = "#f8fafc";
    div.innerHTML = `
      <div class="topic-card-title">${t.id}. ${t.title}</div>
      <div class="topic-card-sub">${t.level}</div>
    `;
    div.addEventListener("click",()=>openTopic(t.id));
    grid.appendChild(div);
  });

  // demo message in AI panel
  const chat = document.getElementById("chatBox");
  chat.innerHTML = "";
  const msg = document.createElement("div");
  msg.className = "chat-msg";
  msg.textContent = "AI Bayan chat will be available later. Now use topics and explanations.";
  chat.appendChild(msg);
  document.getElementById("aiLimit").textContent = "¬∑ demo mode";
}

/* ---------- TOPIC SCREEN ---------- */

function openTopic(id){
  currentTopicId = id;
  const t = topics.find(x=>x.id===id);
  if(!t) return;

  const color = topicColors[id] || "#005b73";
  document.documentElement.style.setProperty("--topicColor",color);

  document.getElementById("topicHeaderTitle").textContent = `${id}. ${t.title}`;
  document.getElementById("topicHeaderTag").innerHTML =
    `<span class="tag">${t.level}</span>`;

  const rc = document.getElementById("topicRuleContainer");
  rc.innerHTML = "";
  const gbox = document.createElement("div");
  gbox.className = "grammar-box";
  gbox.innerHTML = `
    <strong>Rule (EN):</strong> ${t.explanation || ""}
    ${
      t.formulas && t.formulas.length
        ? "<div style='margin-top:6px;'>"+
          t.formulas.map(f=>`<span class="formula">${f}</span>`).join(" ")+
          "</div>"
        : ""
    }
    ${
      t.ruleRu
        ? `<div class="grammar-ru">
             <strong>–ü—Ä–∞–≤–∏–ª–æ (RU):</strong><br>
             ${t.ruleRu}
           </div>`
        : ""
    }
  `;
  rc.appendChild(gbox);

  if(t.examples && t.examples.length){
    const ul = document.createElement("ul");
    ul.className = "examples";
    t.examples.forEach(e=>{
      const li = document.createElement("li");
      li.textContent = e;
      ul.appendChild(li);
    });
    rc.appendChild(ul);
  }

  const ec = document.getElementById("topicExercisesContainer");
  ec.innerHTML = "";
  if(!t.exercises || t.exercises.length===0){
    const p = document.createElement("p");
    p.className = "muted";
    p.style.marginTop = "10px";
    p.textContent = "Exercises for this topic will be added later.";
    ec.appendChild(p);
  }else{
    const wrapper = document.createElement("div");
    wrapper.className = "exercises";
    t.exercises.forEach((ex,exIndex)=>{
      const block = document.createElement("div");
      block.className = "exercise-block";
      const title = document.createElement("div");
      title.className = "exercise-title";
      title.innerHTML = ex.title;
      block.appendChild(title);

      ex.questions.forEach((q,qIndex)=>{
        const row = document.createElement("div");
        row.className = "question-row";
        const qText = document.createElement("div");
        qText.className = "question-text";
        qText.textContent = `${qIndex+1}) ${q.text}`;
        row.appendChild(qText);

        const opts = document.createElement("div");
        opts.className = "options";
        if(q.options && q.options.length){
          q.options.forEach((opt,optIndex)=>{
            const label = document.createElement("label");
            const radio = document.createElement("input");
            radio.type = "radio";
            const gname = `t${id}_e${exIndex}_q${qIndex}`;
            radio.name = gname;
            radio.value = optIndex;
            label.appendChild(radio);
            label.appendChild(document.createTextNode(" "+opt));
            opts.appendChild(label);
          });
        }
        row.appendChild(opts);

        const mark = document.createElement("span");
        mark.className = "mark";
        mark.id = `mark_t${id}_e${exIndex}_q${qIndex}`;
        row.appendChild(mark);

        block.appendChild(row);
      });

      const footer = document.createElement("div");
      footer.className = "exercise-footer";
      const small = document.createElement("small");
      small.textContent = "Each correct answer gives you 1 star.";
      const btn = document.createElement("button");
      btn.className = "btn btn-primary";
      btn.textContent = "Check";
      btn.addEventListener("click",()=>checkExercise(id,exIndex));
      footer.appendChild(small);
      footer.appendChild(btn);
      block.appendChild(footer);

      wrapper.appendChild(block);
    });
    ec.appendChild(wrapper);
  }

  document.getElementById("topicStatus").textContent = "";
  showOnly("topicScreen");
}

function backToMenu(){
  if(!currentUser){
    backToLogin();
    return;
  }
  buildMainMenu();
  showOnly("mainMenuScreen");
}

function printCurrentTopic(){
  if(!currentTopicId) return;
  window.print();
}

function checkExercise(topicId,exIndex){
  if(!currentUser) return;
  const t = topics.find(x=>x.id===topicId);
  if(!t) return;
  const ex = t.exercises[exIndex];
  if(!ex) return;

  let gained = 0;
  ex.questions.forEach((q,qIndex)=>{
    const gname = `t${topicId}_e${exIndex}_q${qIndex}`;
    const selected = document.querySelector(`input[name="${gname}"]:checked`);
    const markEl = document.getElementById(`mark_t${topicId}_e${exIndex}_q${qIndex}`);
    if(!markEl) return;
    markEl.textContent = "";
    markEl.classList.remove("correct","wrong");

    if(!selected){
      markEl.textContent = "‚Ä¢";
      return;
    }
    const chosen = Number(selected.value);
    if(chosen===q.correct){
      markEl.textContent="‚úì";
      markEl.classList.add("correct");
      gained++;
    }else{
      markEl.textContent="‚úó";
      markEl.classList.add("wrong");
    }
  });

  const status = document.getElementById("topicStatus");
  if(gained>0){
    currentUser.stars += gained;
    saveCurrent();
    updateTopStars();
    if(status){
      status.textContent = `Well done! You gained ${gained} star(s).`;
    }
  }else{
    if(status){
      status.textContent = "No correct answers yet. Try again!";
    }
  }
}

/* ---------- TEACHER TABLE ---------- */

function renderTeacherTable(){
  const tbody = document.querySelector("#teacherTable tbody");
  tbody.innerHTML = "";
  const allStudents = [];
  classRanges.forEach(r=>{
    for(let code=r.from; code<=r.to; code++){
      const key = studentKey(code);
      let data = null;
      try{
        data = JSON.parse(localStorage.getItem(key));
      }catch(e){ data=null; }
      if(data) allStudents.push(data);
    }
  });
  if(allStudents.length===0){
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 5;
    td.textContent =
      "No student data in this browser yet. Ask students to log in and work with tasks.";
    tr.appendChild(td);
    tbody.appendChild(tr);
    return;
  }
  allStudents.sort((a,b)=>a.code-b.code);
  allStudents.forEach(s=>{
    const tr = document.createElement("tr");
    const cls = document.createElement("td");
    cls.textContent = s.classLabel || getClassByCode(s.code) || "";
    const codeTd = document.createElement("td");
    codeTd.textContent = s.code;
    const nameTd = document.createElement("td");
    nameTd.textContent = s.name || "";
    const starsTd = document.createElement("td");
    starsTd.textContent = s.stars ?? 0;
    const loginTd = document.createElement("td");
    loginTd.textContent = s.lastLogin || "";
    tr.appendChild(cls);
    tr.appendChild(codeTd);
    tr.appendChild(nameTd);
    tr.appendChild(starsTd);
    tr.appendChild(loginTd);
    tbody.appendChild(tr);
  });
}

/* ---------- INIT & STARS ---------- */

function updateTopStars() {
  if (!currentUser) return;
  const topStarsEl = document.getElementById("topStars");
  if (topStarsEl) {
    topStarsEl.textContent = currentUser.stars;
  }
  const menuStarsEl = document.getElementById("menuStars");
  if (menuStarsEl) {
    menuStarsEl.textContent = currentUser.stars;
  }
}

// —Å—Ç–∞—Ä—Ç—É–µ–º —Å —ç–∫—Ä–∞–Ω–∞ –ª–æ–≥–∏–Ω–∞
showOnly("loginScreen");
</script>
</body>
</html>
